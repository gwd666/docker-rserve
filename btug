# vim:set ft=dockerfile:
FROM stevenpollack/docker-rserve

MAINTAINER "Steven Pollack" steven@gnobel.com

# jags for rjags
# libcurl4 & libssl for devtools
RUN apt-get update && \
    apt-get install -y \
    jags \
    libcurl4-openssl-dev \
    libssl-dev && \
    apt-get clean  && \
    rm -rf /var/lib/apt/lists/

# devtools & rjags for BayesianFirstAid
# hopach for clustering
# randomForest for classification/regression
RUN install2.r --error \
    -r "https://cran.rstudio.com" \ 
    -r "http://www.bioconductor.org/packages/release/bioc" \
    devtools \
    hopach \
    randomForest \
    rjags && \
    Rscript -e " \
    options(unzip = 'internal'); \
    httr::set_config( httr::config( ssl_verifypeer = 0L ) ); \
    devtools::install_github('rasmusab/bayesian_first_aid')" && \ 
    rm -rf /tmp/downloaded_packages/ /tmp/*.rds

# you have to run Rserve with remote=TRUE otherwise
# it won't let you connect to the container
EXPOSE 6311
ENTRYPOINT R -e "\
library(hopach); \
library(randomForest); \
library(BayesianFirstAid); \
Rserve::run.Rserve(remote=TRUE)"

